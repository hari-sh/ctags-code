"use strict";(()=>{var t={186:t=>{t.exports=require("level")},191:(t,e,n)=>{const{getValueFromDb:o,getDB:a,batchWriteIntoDB:i}=n(679),r=n(398),s=n(896),c=n(785),l=n(928);async function u(t,e,n){if(!n)return;const o=e?e.document:null,a=e?e.selection:null,i=await async function(t,e,n,o){return"F"===t.tagKind?await async function(t,e){let n=e.end.translate(0,1),o=t.getWordRangeAtPosition(n);if(o){let e=t.getText(o);if(e.match(/[0-9]+/)){const a=Math.max(0,parseInt(e,10)-1);let i=0;return n=o.end.translate(0,1),o=t.getWordRangeAtPosition(n),o&&(e=t.getText(o),e.match(/[0-9]+/)&&(i=Math.max(0,parseInt(e)-1))),console.log(`ctags-code: Resolved file position to line ${a+1}, char ${i+1}`),new r.Selection(a,i,a,i)}}}(e,n):await async function(t,e){let n=!1,o=t.pattern;if(!o.startsWith("^"))return void console.error(`ctags-code: Unsupported pattern ${o}`);o=o.substring(1,o.length),o.endsWith("$")&&(o=o.substring(0,o.length-1),n=!0),console.log(o);const a=await async function(t,e,n,o,a){const i=s.createReadStream(t),r=c.createInterface({input:i,crlfDelay:1/0});let l=0,u=0,f=!1;for await(const t of r){if(l+=1,a&&t===o||t.startsWith(o))return f=!0,u=Math.max(t.indexOf(e),0),console.log(`ctags-code: Found '${o}' at ${l}:${u}`),{retval:!1,found:f,lno:l,charPos:u};if(n&&n.isCancellationRequested)return console.log("ctags-code: Cancelled pattern searching"),{retval:!1,found:f,lno:l,charPos:u}}}(t.file,t.name,e,o,n);return console.log(a),a.found?new r.Selection(a.lno-1,a.charPos,a.lno-1,a.charPos):void 0}(t,o)}(n,o,a);return async function(t,e,n,o){const a=await r.workspace.openTextDocument(n),i={viewColumn:e?e.viewColumn:r.ViewColumn.One,selection:o};return await r.window.showTextDocument(a,i)}(0,e,n.file,i)}t.exports={jumputil:async function(t,e,n){if(!n)return;const a=await o(`tag:${n}`);if(a){console.log("Found:",a);const e=[a].map((t=>(l.isAbsolute(t.file)||(t.file=l.join(r.workspace.rootPath,t.file)),t.description="",t.label=t.file,t.detail=t.pattern,t.lno=0,t)));return e.length?1===e.length?u(0,t,e[0]):r.window.showQuickPick(e).then((e=>u(0,t,e))):r.window.showInformationMessage(`ctags-code: No tags found for ${tag}`)}console.log("Key not found")},getTag:function(t){const e=t.document.getText(t.selection).trim();if(!e){const e=t.document.getWordRangeAtPosition(t.selection.active);if(e)return t.document.getText(e)}return e},storeTagsToDB:async function(t){const e=s.createReadStream(t),n=c.createInterface({input:e,crlfDelay:1/0}),o=a();let l=[];for await(const t of n){if(t.startsWith("!"))continue;const e=t.split("\t");if(e.length<3)continue;const[n,o,a,r]=e,s=[...a.matchAll(/\/(.*?)\//g)].map((t=>t[1]));l.push({type:"put",key:`tag:${n}`,value:{file:o,pattern:s[0],tokens:(u=n,u.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/([A-Z])([A-Z][a-z])/g,"$1 $2").replace(/[_\-]+/g," ").toLowerCase().split(/\s+/).filter(Boolean)),tagKind:r}}),l.length>=1e3&&(await i(l),l=[])}var u;l.length>0&&await i(l),await o.close(),await o.open(),r.window.showInformationMessage("Tags are parsed")}}},398:t=>{t.exports=require("vscode")},497:(t,e,n)=>{const o=n(398),a=n(928),{jumputil:i,getTag:r,storeTagsToDB:s}=(n(896),n(191)),{initDB:c,closeDB:l,assignIdsToVariables:u,searchQuery:f}=n(679);async function g(){await s(a.join(o.workspace.rootPath,"tags")),await u()}async function d(t){const e=o.window.createQuickPick();e.placeholder="Search tags...",e.matchOnDescription=!0,e.filterItems=!1,e.matchOnDescription=!1,e.matchOnDetail=!1,e.onDidChangeValue((async t=>{if(!t)return void(e.items=[]);const n=await f(t);e.items=n.map((t=>({label:t.label,description:t.description,alwaysShow:!0})))})),e.onDidAccept((()=>{const n=e.selectedItems[0];n&&i(o.window.activeTextEditor,t,n.label),e.hide()})),e.onDidHide((()=>e.dispose())),e.show()}async function p(t){const e=o.window.activeTextEditor,n=r(e);return i(e,t,n)}t.exports={activate(t){c(),t.subscriptions.push(o.commands.registerCommand("extension.storeTags",g)),t.subscriptions.push(o.commands.registerCommand("extension.searchTags",d)),t.subscriptions.push(o.commands.registerCommand("extension.jumpTag",p))},deactivate(){l()}}},679:(t,e,n)=>{const o=n(928),{Level:a}=n(186),i=n(398);let r;n(896);const s=o.join(i.workspace.rootPath,"tagsdb"),c=t=>t.replace(/\.[a-zA-Z0-9]+$/,"").replace(/([a-z])([A-Z])/g,"$1 $2").replace(/[_\-\.\/]+/g," ").replace(/[^a-zA-Z0-9 ]/g,"").toLowerCase().split(/\s+/).filter(Boolean);t.exports={initDB:function(){return r||(r=new a(s,{valueEncoding:"json"})),r},getDB:function(){if(!r)throw new Error("DB is not initialized.");return r},closeDB:function(){if(!r)throw new Error("DB is not initialized.");r.close()},getValueFromDb:async function(t){try{return await r.get(t)}catch(t){if(t.notFound)return null;throw t}},batchWriteIntoDB:async function(t){try{await r.batch(t)}catch(t){console.error("Batch write failed:",t)}},searchQuery:async t=>{const e=c(t);if(0===e.length)return[];2===e.length&&console.log();const n=[];for(const t of e){const e=new Set;for await(const[n,o]of r.iterator({gte:`token:${t}`,lt:`token:${t}~`})){if(Array.isArray(o))for(const t of o)"number"==typeof t&&Number.isInteger(t)&&e.add(t);if(e.size>=1e3)break}if(!e.size)return[];n.push(e)}let o=n[0];for(let t=1;t<n.length;t++)if(o=new Set([...o].filter((e=>n[t].has(e)))),!o.size)return[];const a=[];for(const t of o){if(a.length>=10)break;try{const e=await r.get(`id:${t}`),n=await r.get(`tag:${e}`);a.push({label:e,description:n?.file||""})}catch{}}return a},assignIdsToVariables:async()=>{let t=1;const e=new Map,n=r.batch();for await(const[o,a]of r.iterator({gte:"tag:",lt:"tag;"})){const a=o.slice(4),i=t++;n.put(`id:${i}`,a);for(const t of c(a))e.has(t)||e.set(t,new Set),e.get(t).add(i)}for(const[t,o]of e)n.put(`token:${t}`,Array.from(o));n.put("id:counter",t-1),await n.write(),console.log(`âœ… Assigned IDs to ${t-1} variables and built token index.`)}}},785:t=>{t.exports=require("readline")},896:t=>{t.exports=require("fs")},928:t=>{t.exports=require("path")}},e={},n=function n(o){var a=e[o];if(void 0!==a)return a.exports;var i=e[o]={exports:{}};return t[o](i,i.exports,n),i.exports}(497);module.exports=n})();
//# sourceMappingURL=extension.js.map