"use strict";(()=>{var t={186:t=>{t.exports=require("level")},191:(t,e,n)=>{const{getValueFromDb:o,getDB:i,batchWriteIntoDB:r}=n(679),a=n(398),s=n(896),c=n(785),l=n(928);async function u(t,e,n){if(!n)return;const o=e?e.document:null,i=e?e.selection:null,r=await async function(t,e,n,o){return"F"===t.tagKind?await async function(t,e){let n=e.end.translate(0,1),o=t.getWordRangeAtPosition(n);if(o){let e=t.getText(o);if(e.match(/[0-9]+/)){const i=Math.max(0,parseInt(e,10)-1);let r=0;return n=o.end.translate(0,1),o=t.getWordRangeAtPosition(n),o&&(e=t.getText(o),e.match(/[0-9]+/)&&(r=Math.max(0,parseInt(e)-1))),console.log(`ctags-code: Resolved file position to line ${i+1}, char ${r+1}`),new a.Selection(i,r,i,r)}}}(e,n):await async function(t,e){let n=!1,o=t.pattern;if(!o.startsWith("^"))return void console.error(`ctags-code: Unsupported pattern ${o}`);o=o.substring(1,o.length),o.endsWith("$")&&(o=o.substring(0,o.length-1),n=!0),console.log(o);const i=await async function(t,e,n,o,i){const r=s.createReadStream(t),a=c.createInterface({input:r,crlfDelay:1/0});let l=0,u=0,d=!1;for await(const t of a){if(l+=1,i&&t===o||t.startsWith(o))return d=!0,u=Math.max(t.indexOf(e),0),console.log(`ctags-code: Found '${o}' at ${l}:${u}`),{retval:!1,found:d,lineNumber:l,charPos:u};if(n&&n.isCancellationRequested)return console.log("ctags-code: Cancelled pattern searching"),{retval:!1,found:d,lineNumber:l,charPos:u}}}(t.file,t.name,e,o,n);return console.log(i),i.found?new a.Selection(i.lineNumber-1,i.charPos,i.lineNumber-1,i.charPos):void 0}(t,o)}(n,o,i);return async function(t,e,n,o){const i=await a.workspace.openTextDocument(n),r={viewColumn:e?e.viewColumn:a.ViewColumn.One,selection:o};return await a.window.showTextDocument(i,r)}(0,e,n.file,r)}t.exports={jumputil:async function(t,e,n){t&&n&&o(n).then((e=>{if(e){console.log("Found:",e);const n=[e].map((t=>(l.isAbsolute(t.file)||(t.file=l.join(a.workspace.rootPath,t.file)),t.description="",t.label=t.file,t.detail=t.pattern,t.lineNumber=0,t)));return n.length?1===n.length?u(0,t,n[0]):a.window.showQuickPick(n).then((e=>u(0,t,e))):a.window.showInformationMessage(`ctags-code: No tags found for ${tag}`)}console.log("Key not found")}))},getTag:function(t){const e=t.document.getText(t.selection).trim();if(!e){const e=t.document.getWordRangeAtPosition(t.selection.active);if(e)return t.document.getText(e)}return e},storeTagsToDB:async function(t){const e=s.createReadStream(t),n=c.createInterface({input:e,crlfDelay:1/0}),o=i();let l=[];for await(const t of n){if(t.startsWith("!"))continue;const e=t.split("\t");if(e.length<3)continue;const[n,o,i,a]=e,s=[...i.matchAll(/\/(.*?)\//g)].map((t=>t[1]));l.push({type:"put",key:n,value:{file:o,pattern:s[0],tagKind:a}}),l.length>=1e3&&(await r(l),l=[])}l.length>0&&await r(l),await o.close(),await o.open(),a.window.showInformationMessage("Tags are parsed")}}},398:t=>{t.exports=require("vscode")},497:(t,e,n)=>{const o=n(398),i=n(928),{jumputil:r,getTag:a,storeTagsToDB:s}=n(191),{initDB:c,closeDB:l,getEntriesWithPrefix:u}=n(679);async function d(){s(i.join(o.workspace.rootPath,"tags"))}async function f(t){const e=o.window.createQuickPick();e.placeholder="Search tags...",e.matchOnDescription=!0,e.onDidChangeValue((async t=>{if(!t)return void(e.items=[]);const n=await u(t);e.items=n.map((t=>({label:t.key,description:t.value.file})))})),e.onDidAccept((()=>{const n=e.selectedItems[0];n&&r(o.window.activeTextEditor,t,n.label),e.hide()})),e.onDidHide((()=>e.dispose())),e.show()}async function g(t){const e=o.window.activeTextEditor,n=a(e);return r(e,t,n)}t.exports={activate(t){c(),t.subscriptions.push(o.commands.registerCommand("extension.storeTags",d)),t.subscriptions.push(o.commands.registerCommand("extension.searchTags",f)),t.subscriptions.push(o.commands.registerCommand("extension.jumpTag",g))},deactivate(){l()}}},679:(t,e,n)=>{const o=n(928),{Level:i}=n(186),r=n(398);let a;const s=o.join(r.workspace.rootPath,"tagsdb");t.exports={initDB:function(){return a||(a=new i(s,{valueEncoding:"json"})),a},getDB:function(){if(!a)throw new Error("DB is not initialized.");return a},closeDB:function(){if(!a)throw new Error("DB is not initialized.");a.close()},getValueFromDb:async function(t){try{return await a.get(t)}catch(t){if(t.notFound)return null;throw t}},getEntriesWithPrefix:async function(t,e=10){const n=[],o=a.iterator({gte:t,lte:t+"Ã¿",keyEncoding:"utf8",valueEncoding:"json"});try{for await(const[t,i]of o)if(n.push({key:t,value:i}),n.length>=e)break}catch(t){throw console.error("Iterator error:",t),t}finally{await o.close()}return n},batchWriteIntoDB:async function(t){try{await a.batch(t)}catch(t){console.error("Batch write failed:",t)}}}},785:t=>{t.exports=require("readline")},896:t=>{t.exports=require("fs")},928:t=>{t.exports=require("path")}},e={},n=function n(o){var i=e[o];if(void 0!==i)return i.exports;var r=e[o]={exports:{}};return t[o](r,r.exports,n),r.exports}(497);module.exports=n})();
//# sourceMappingURL=extension.js.map