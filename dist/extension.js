"use strict";(()=>{var t={186:t=>{t.exports=require("level")},191:(t,e,o)=>{const{getValueFromDb:n,getDB:a,batchWriteIntoDB:r}=o(679),i=o(398),s=o(896),c=o(785),l=o(928);async function u(t,e,o){if(!o)return;const n=e?e.document:null,a=e?e.selection:null,r=await async function(t,e,o,n){return"F"===t.tagKind?await async function(t,e){let o=e.end.translate(0,1),n=t.getWordRangeAtPosition(o);if(n){let e=t.getText(n);if(e.match(/[0-9]+/)){const a=Math.max(0,parseInt(e,10)-1);let r=0;return o=n.end.translate(0,1),n=t.getWordRangeAtPosition(o),n&&(e=t.getText(n),e.match(/[0-9]+/)&&(r=Math.max(0,parseInt(e)-1))),console.log(`ctags-code: Resolved file position to line ${a+1}, char ${r+1}`),new i.Selection(a,r,a,r)}}}(e,o):await async function(t,e){let o=!1,n=t.pattern;if(!n.startsWith("^"))return void console.error(`ctags-code: Unsupported pattern ${n}`);n=n.substring(1,n.length),n.endsWith("$")&&(n=n.substring(0,n.length-1),o=!0),console.log(n);const a=await async function(t,e,o,n,a){const r=s.createReadStream(t),i=c.createInterface({input:r,crlfDelay:1/0});let l=0,u=0,f=!1;for await(const t of i){if(l+=1,a&&t===n||t.startsWith(n))return f=!0,u=Math.max(t.indexOf(e),0),console.log(`ctags-code: Found '${n}' at ${l}:${u}`),{retval:!1,found:f,lno:l,charPos:u};if(o&&o.isCancellationRequested)return console.log("ctags-code: Cancelled pattern searching"),{retval:!1,found:f,lno:l,charPos:u}}}(t.file,t.name,e,n,o);return console.log(a),a.found?new i.Selection(a.lno-1,a.charPos,a.lno-1,a.charPos):void 0}(t,n)}(o,n,a);return async function(t,e,o,n){const a=await i.workspace.openTextDocument(o),r={viewColumn:e?e.viewColumn:i.ViewColumn.One,selection:n};return await i.window.showTextDocument(a,r)}(0,e,o.file,r)}t.exports={jumputil:async function(t,e,o){if(!o)return;const a=await n(`tag:${o}`);if(a){console.log("Found:",a);const e=[a].map((t=>(l.isAbsolute(t.file)||(t.file=l.join(i.workspace.rootPath,t.file)),t.description="",t.label=t.file,t.detail=t.pattern,t.lno=0,t)));return e.length?1===e.length?u(0,t,e[0]):i.window.showQuickPick(e).then((e=>u(0,t,e))):i.window.showInformationMessage(`ctags-code: No tags found for ${tag}`)}console.log("Key not found")},getTag:function(t){const e=t.document.getText(t.selection).trim();if(!e){const e=t.document.getWordRangeAtPosition(t.selection.active);if(e)return t.document.getText(e)}return e},storeTagsToDB:async function(t){const e=s.createReadStream(t),o=c.createInterface({input:e,crlfDelay:1/0}),n=a();let l=[];for await(const t of o){if(t.startsWith("!"))continue;const e=t.split("\t");if(e.length<3)continue;const[o,n,a,i]=e,s=[...a.matchAll(/\/(.*?)\//g)].map((t=>t[1]));l.push({type:"put",key:`tag:${o}`,value:{file:n,pattern:s[0],tokens:(u=o,u.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/([A-Z])([A-Z][a-z])/g,"$1 $2").replace(/[_\-]+/g," ").toLowerCase().split(/\s+/).filter(Boolean)),tagKind:i}}),l.length>=1e3&&(await r(l),l=[])}var u;l.length>0&&await r(l),await n.close(),await n.open(),i.window.showInformationMessage("Tags are parsed")}}},398:t=>{t.exports=require("vscode")},497:(t,e,o)=>{const n=o(398),a=o(928),{jumputil:r,getTag:i,storeTagsToDB:s}=(o(896),o(191)),{initDB:c,closeDB:l,getEntriesWithPrefix:u,assignIdsToVariables:f,searchQuery:g,exportVariablesToJson:d}=o(679);async function p(){await s(a.join(n.workspace.rootPath,"tags")),await f(),await d(a.join(n.workspace.rootPath,"variables.json"))}async function h(t){const e=n.window.createQuickPick();e.placeholder="Search tags...",e.matchOnDescription=!0,e.filterItems=!1,e.matchOnDescription=!1,e.matchOnDetail=!1,e.onDidChangeValue((async t=>{if(!t)return void(e.items=[]);const o=await g(t);e.items=o.map((t=>({label:t.label,description:t.description,alwaysShow:!0})))})),e.onDidAccept((()=>{const o=e.selectedItems[0];o&&r(n.window.activeTextEditor,t,o.label),e.hide()})),e.onDidHide((()=>e.dispose())),e.show()}async function w(t){const e=n.window.activeTextEditor,o=i(e);return r(e,t,o)}t.exports={activate(t){c(),t.subscriptions.push(n.commands.registerCommand("extension.storeTags",p)),t.subscriptions.push(n.commands.registerCommand("extension.searchTags",h)),t.subscriptions.push(n.commands.registerCommand("extension.jumpTag",w))},deactivate(){l()}}},679:(t,e,o)=>{const n=o(928),{Level:a}=o(186),r=o(398),i=o(896);let s;const c=n.join(r.workspace.rootPath,"tagsdb"),l=t=>t.replace(/\.[a-zA-Z0-9]+$/,"").replace(/([a-z])([A-Z])/g,"$1 $2").replace(/[_\-\.\/]+/g," ").replace(/[^a-zA-Z0-9 ]/g,"").toLowerCase().split(/\s+/).filter(Boolean);t.exports={initDB:function(){return s||(s=new a(c,{valueEncoding:"json"})),s},getDB:function(){if(!s)throw new Error("DB is not initialized.");return s},closeDB:function(){if(!s)throw new Error("DB is not initialized.");s.close()},getValueFromDb:async function(t){try{return await s.get(t)}catch(t){if(t.notFound)return null;throw t}},getEntriesWithPrefix:async function(t,e=10){const o=[],n=s.iterator({gte:t,lte:t+"ÿ",keyEncoding:"utf8",valueEncoding:"json"});try{for await(const[t,a]of n)if(o.push({key:t,value:a}),o.length>=e)break}catch(t){throw console.error("Iterator error:",t),t}finally{await n.close()}return o},batchWriteIntoDB:async function(t){try{await s.batch(t)}catch(t){console.error("Batch write failed:",t)}},searchQuery:async t=>{const e=l(t);if(0===e.length)return[];2===e.length&&console.log();const o=[];for(const t of e){const e=new Set;for await(const[o,n]of s.iterator({gte:`token:${t}`,lt:`token:${t}~`})){if(Array.isArray(n))for(const t of n)"number"==typeof t&&Number.isInteger(t)&&e.add(t);if(e.size>=1e3)break}if(!e.size)return[];o.push(e)}let n=o[0];for(let t=1;t<o.length;t++)if(n=new Set([...n].filter((e=>o[t].has(e)))),!n.size)return[];const a=[];for(const t of n){if(a.length>=10)break;try{const e=await s.get(`id:${t}`),o=await s.get(`tag:${e}`);a.push({label:e,description:o?.file||""})}catch{}}return a},assignIdsToVariables:async()=>{let t=1;const e=new Map,o=s.batch();for await(const[n,a]of s.iterator({gte:"tag:",lt:"tag;"})){const a=n.slice(4),r=t++;o.put(`id:${r}`,a);for(const t of l(a))e.has(t)||e.set(t,new Set),e.get(t).add(r)}for(const[t,n]of e)o.put(`token:${t}`,Array.from(n));o.put("id:counter",t-1),await o.write(),console.log(`✅ Assigned IDs to ${t-1} variables and built token index.`)},exportVariablesToJson:async t=>{const e=[];for await(const[t,o]of s.iterator())e.push({key:t,value:o});((t,e)=>{const o=JSON.stringify(e,null,2);i.writeFile(t,o,"utf8",(e=>{e?console.error("❌ Failed to write JSON:",e):console.log(`✅ Saved to ${t}`)}))})(t,JSON.stringify(e,null,2)),console.log(`✅ Exported ${e.length} variables to ${t}`)}}},785:t=>{t.exports=require("readline")},896:t=>{t.exports=require("fs")},928:t=>{t.exports=require("path")}},e={},o=function o(n){var a=e[n];if(void 0!==a)return a.exports;var r=e[n]={exports:{}};return t[n](r,r.exports,o),r.exports}(497);module.exports=o})();
//# sourceMappingURL=extension.js.map